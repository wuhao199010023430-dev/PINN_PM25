# PM2.5预测模型统一配置文件
# 支持单数据源和多数据源场景

# =========================== 全局参数 ===========================
model_type: adaptive_ms_pinn  # 模型类型：adaptive_ms_pinn, lstm, transformer, gru
seed: 42                       # 随机种子，确保结果可复现
device: auto                   # 设备选择：auto（自动检测）, cuda, cpu

# =========================== 数据参数 ===========================
data:
  # 基础数据参数
  seq_len: 3                  # 序列长度，用于构建时间序列数据，单位：小时
  batch_size: 3               # 批量大小，影响训练速度和内存占用
  time_resolution: "1h"         # 数据时间分辨率，可选：1h, 3h, 6h, 12h, 24h
  test_split: 0.2              # 测试集比例
  val_split: 0.1               # 验证集比例
  
  # 空间位置参数
  target_latitude: 39.9042     # 目标监测点纬度（用于空间特征计算）
  target_longitude: 116.4074   # 目标监测点经度（用于空间特征计算）
  
  # 数据源配置
  # 支持1个或多个数据源，每个数据源类型对应不同的处理逻辑
  # 数据源类型：meteorological（气象）, mobile（移动走航）, lidar（激光雷达）, microsite（小微站）
  data_sources:
    # 示例1：单个数据源
    # meteorological: "data/pm25_data.csv"
    
    # 示例2：多个数据源
    meteorological: "data/pm25_data_template.csv"  # 气象数据
    mobile: "data/pm25_data_template.csv"          # 移动走航数据
    lidar: "data/pm25_data_template.csv"           # 激光雷达数据
    microsite: "data/pm25_data_template.csv"        # 小微站数据

# =========================== 模型参数 ===========================
model:
  # 通用模型参数
  hidden_dim: 128              # 隐藏层维度，影响模型表达能力
  num_layers: 3                # 网络层数，影响模型复杂度
  dropout: 0.2                 # Dropout率，防止过拟合
  weight_decay: 0.0001         # L2正则化系数，防止过拟合
  
  # 自适应多尺度PINN特有参数
  num_adaptive_layers: 3       # 自适应层数量，控制自适应特征学习能力
  alpha: 0.1                   # 物理损失权重，平衡数据损失和物理约束损失
  input_dim: 25                # 输入特征维度（可自动调整）
  
  # Transformer相关参数（部分模型使用）
  d_model: 128                 # Transformer模型维度
  nhead: 4                     # 注意力头数量
  num_encoder_layers: 2        # Transformer编码器层数

# =========================== 训练参数 ===========================
training:
  epochs: 100                  # 训练轮次
  lr: 0.001                    # 学习率，影响模型收敛速度
  patience: 10                 # 早停机制patience值，连续10轮验证集损失不下降则停止训练
  lr_scheduler: true           # 是否启用学习率调度器
  early_stopping: true         # 是否启用早停机制
  
  # 自适应反馈机制
  adaptive_feedback: false      # 是否启用自适应反馈机制
  # 自适应反馈机制会根据数据源数量、质量和训练情况自动调整模型参数，提高训练效果
  # 详细说明：
  # 1. 数据处理策略调整：
  #    - 单数据源：简化数据处理，降低计算成本
  #    - 多数据源：增强数据融合，优化时间分辨率对齐
  #    - 低质量数据：增加数据清洗和异常值处理
  # 2. 特征工程方法调整：
  #    - 单数据源：基础特征保留，减少交互特征生成
  #    - 多数据源：完整特征工程，生成丰富的交互特征
  #    - 时序数据：动态调整序列长度（24 → 48小时）
  # 3. 模型复杂度调整：
  #    - 数据量少：减少网络层数和隐藏层维度
  #    - 数据量大：增加网络复杂度，提高表达能力
  #    - 过拟合风险：动态调整dropout率和正则化系数
  # 4. 训练参数调整：
  #    - 训练初期：使用较大学习率加速收敛
  #    - 训练后期：减小学习率微调模型
  #    - 训练停滞：自动调整早停机制和学习率调度器
  # 5. 数据源类型适配：
  #    - 移动走航数据：增强空间特征处理
  #    - 激光雷达数据：优化垂直剖面特征提取
  #    - 小微站数据：改进多站点数据融合
  # 启用建议：
  #    - 复杂数据源场景：建议启用
  #    - 简单场景：可关闭以提高训练速度
  #    - 首次训练：建议关闭，了解基础性能
  #    - 调优阶段：建议启用，自动寻找最优参数

# =========================== 特征工程参数 ===========================
feature_engineering:
  auto_scale: true             # 是否自动缩放特征（标准化/归一化）
  feature_selection: true      # 是否启用特征选择，自动筛选重要特征
  temporal_features: true      # 是否生成时间特征（小时、星期、月份等）
  spatial_features: true       # 是否生成空间特征（距离、方向等）
  interaction_features: true   # 是否生成特征交互项
  rolling_features: true       # 是否生成滚动统计特征
  
  # 数据源特有特征处理
  meteorological_features: true  # 是否处理气象数据特有特征
  mobile_features: true         # 是否处理移动走航数据特有特征
  lidar_features: true          # 是否处理激光雷达数据特有特征
  microsite_features: true      # 是否处理小微站数据特有特征

# =========================== 输出参数 ===========================
output:
  save_model: true             # 是否保存训练后的模型
  save_figures: true           # 是否保存可视化结果
  save_metrics: true           # 是否保存评估指标
  model_dir: "models/saved"     # 模型保存目录
  figures_dir: "figures"        # 可视化结果保存目录
  metrics_dir: "metrics"        # 评估指标保存目录
  log_level: "INFO"            # 日志级别：DEBUG, INFO, WARNING, ERROR, CRITICAL
